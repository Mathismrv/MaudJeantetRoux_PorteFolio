<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Illustrations</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="header-image">
        <img src="image/Titre_page.gif" alt="Logo" class="header-gif">
        <!-- Admin Link -->
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('dashboard') }}" class="admin-btn" style="text-decoration: none;">Espace Propriétaire</a>
        {% else %}
            <a href="{{ url_for('login') }}" class="admin-btn" style="text-decoration: none;">Propriétaire</a>
        {% endif %}

        <nav>
            <ul class="nav-links">
                <li><a href="home.html">Accueil</a></li>
                <li><a href="portfolio.html">Portfolio</a></li>
                <li><a href="projets.html">Projets</a></li>
                <li><a href="illustrations.html" style="color: var(--accent-color);">Illustrations</a></li>
                <li><a href="contact.html">Contact / CV</a></li>
            </ul>
        </nav>
    </div>

    <main>
        <section class="hero">
            <h1>Illustrations</h1>
        </section>

        <div class="masonry-grid">
            <!-- Gallery Images -->
            {% for illustration in illustrations %}
            <div class="masonry-item" onclick="openImage({{ loop.index0 }})">
                <img src="{{ illustration.image_url }}" alt="Illustration">
            </div>
            {% endfor %}
        </div>

        <!-- Image Modal (Lightbox) -->
        <div id="imageModal" class="modal">
            <span class="close-btn" onclick="closeImageModal()" style="position: absolute; top: 20px; right: 30px; color: white; font-size: 40px; z-index: 2001;">&times;</span>
            
            <!-- Navigation Arrows -->
            <a class="prev" onclick="changeImage(-1)">&#10094;</a>
            <a class="next" onclick="changeImage(1)">&#10095;</a>

            <img id="fullImage" style="margin: auto; display: block; width: auto; max-width: 90%; max-height: 90vh; border-radius: 5px; box-shadow: 0 0 20px rgba(0,0,0,0.5);">
        </div>

        <script>
            // List of images generated by Flask
            const images = {{ illustrations | map(attribute='image_url') | list | tojson }};
            
            let currentIndex = 0;

            function openImage(index) {
                currentIndex = index;
                var modal = document.getElementById("imageModal");
                var modalImg = document.getElementById("fullImage");
                
                modal.style.display = "flex";
                modal.style.alignItems = "center";
                modal.style.justifyContent = "center";
                
                updateImage();
                document.body.style.overflow = "hidden"; // Prevent scrolling
            }

            function closeImageModal() {
                document.getElementById("imageModal").style.display = "none";
                document.body.style.overflow = "auto"; // Restore scrolling
            }

            function changeImage(n) {
                currentIndex += n;
                if (currentIndex >= images.length) {
                    currentIndex = 0;
                } else if (currentIndex < 0) {
                    currentIndex = images.length - 1;
                }
                updateImage();
            }

            function updateImage() {
                var modalImg = document.getElementById("fullImage");
                modalImg.src = images[currentIndex];
            }

            // Close modal when clicking outside the image
            document.getElementById("imageModal").addEventListener("click", function(e) {
                if (e.target === this) {
                    closeImageModal();
                }
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (document.getElementById("imageModal").style.display === "flex") {
                    if (e.key === "ArrowLeft") {
                        changeImage(-1);
                    } else if (e.key === "ArrowRight") {
                        changeImage(1);
                    } else if (e.key === "Escape") {
                        closeImageModal();
                    }
                }
            });

            // --- Admin Logic ---
            function openLoginModal() {
                document.getElementById("loginModal").style.display = "block";
            }

            function closeLoginModal() {
                document.getElementById("loginModal").style.display = "none";
            }

            function checkLogin() {
                var pass = document.getElementById("adminPass").value;
                if (pass === "admin123") { // Simple password for demo
                    closeLoginModal();
                    document.getElementById("uploadModal").style.display = "block";
                } else {
                    alert("Mot de passe incorrect");
                }
            }

            function closeUploadModal() {
                document.getElementById("uploadModal").style.display = "none";
            }

            function previewImage(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var preview = document.getElementById('uploadPreview');
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            }

            function uploadImage() {
                var input = document.getElementById("imageInput");
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var newSrc = e.target.result;
                        
                        // Add to grid
                        var grid = document.querySelector(".grid");
                        var newCard = document.createElement("div");
                        newCard.className = "card";
                        newCard.style = "padding: 0; overflow: hidden; cursor: pointer;";
                        newCard.onclick = function() { openImage(images.length); }; // Index will be last
                        
                        var newImg = document.createElement("img");
                        newImg.src = newSrc;
                        newImg.style = "width: 100%; height: 100%; object-fit: cover; display: block; transition: transform 0.3s ease;";
                        
                        newCard.appendChild(newImg);
                        grid.appendChild(newCard);

                        // Add to lightbox list
                        images.push(newSrc);

                        closeUploadModal();
                        alert("Image ajoutée ! (Note: Disparaîtra au rechargement de la page car pas de serveur)");
                    }
                    reader.readAsDataURL(input.files[0]);
                } else {
                    alert("Veuillez sélectionner une image");
                }
            }
        </script>

        <!-- Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content" style="max-width: 400px; text-align: center;">
                <span class="close-btn" onclick="closeLoginModal()">&times;</span>
                <h2>Connexion Admin</h2>
                <div style="margin: 2rem 0;">
                    <input type="password" id="adminPass" placeholder="Mot de passe" style="padding: 10px; width: 100%; margin-bottom: 1rem;">
                    <button class="btn" onclick="checkLogin()">Se connecter</button>
                </div>
            </div>
        </div>

        <!-- Upload Modal -->
        <div id="uploadModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <span class="close-btn" onclick="closeUploadModal()">&times;</span>
                <h2>Ajouter une Illustration</h2>
                <div class="upload-form">
                    <label>Choisir une image :</label>
                    <input type="file" id="imageInput" accept="image/*" onchange="previewImage(this)">
                    <img id="uploadPreview" class="upload-preview">
                    <button class="btn" onclick="uploadImage()">Ajouter à la galerie</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Maud Jeantet Roux. Tous droits réservés.</p>
    </footer>

</body>
</html>